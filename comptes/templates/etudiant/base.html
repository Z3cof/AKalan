{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Étudiant - AKalan{% endblock %}</title>

    {% tailwind_css %}
    <link rel="stylesheet" href="{% static 'css/dist/styles.css' %}">

    <style>
        /* ===== ANIMATIONS ===== */
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .sidebar-item {
            transition: all 0.25s ease;
        }

        .sidebar-item:hover {
            transform: translateX(6px);
        }

        /* Transition douce pour les icônes */
        .sidebar-item svg {
            transition: transform 0.25s ease, filter 0.25s ease;
        }

        /* ===== ICON ACTIVE ANIMATION ===== */
        @keyframes iconPulse {
            0% {
                transform: scale(1);
                filter: drop-shadow(0 0 0 rgba(59,130,246,0));
            }
            50% {
                transform: scale(1.08);
                filter: drop-shadow(0 0 6px rgba(59,130,246,0.6));
            }
            100% {
                transform: scale(1);
                filter: drop-shadow(0 0 0 rgba(59,130,246,0));
            }
        }

        .sidebar-item.active svg {
            animation: iconPulse 1.4s ease-in-out infinite;
        }

        /* ===== MOBILE SIDEBAR CLEAN ===== */
        @media (max-width: 768px) {

            #sidebar {
                position: fixed;
                inset: 0 auto 0 0;
                width: 16rem;
                background: #1f2937;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 50;
                touch-action: pan-y;
            }

            body.sidebar-open #sidebar {
                transform: translateX(0);
                box-shadow: 12px 0 25px rgba(0,0,0,0.45);
            }

            #mobile-menu-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.45);
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease;
                z-index: 40;
            }

            body.sidebar-open #mobile-menu-overlay {
                opacity: 1;
                pointer-events: auto;
            }

            body.sidebar-open {
                overflow: hidden;
            }

            body.sidebar-open .sidebar-item {
                animation: slideInLeft 0.35s ease both;
            }
        }

        /* ===== DESKTOP ===== */
        @media (min-width: 769px) {
            #sidebar {
                position: static;
                transform: none !important;
            }

            #mobile-menu-overlay {
                display: none !important;
            }
        }
    </style>
</head>

<body class="bg-gray-900">

{% if user.is_authenticated and user.role == 'etudiant' %}

<div class="flex h-screen overflow-hidden">

    <!-- OVERLAY -->
    <div id="mobile-menu-overlay"></div>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="text-white flex flex-col border-r border-gray-700">

        <!-- Logo -->
        <div class="p-6 border-b border-gray-700">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center font-bold text-xl">A</div>
                <div>
                    <h1 class="text-xl font-bold">AKalan</h1>
                    <p class="text-xs text-gray-400">Plateforme E-Learning</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 p-4 space-y-2">
            <a href="{% url 'etudiants:dashboard_etudiant' %}"
               class="sidebar-item flex items-center px-4 py-3 rounded-lg
               {% if request.resolver_match.url_name == 'dashboard_etudiant' %}
                   active bg-blue-600 text-white
               {% else %}
                   text-gray-300 hover:bg-gray-700 hover:text-white
               {% endif %}">

                <svg class="w-5 h-5 mr-3 shrink-0" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9.75L12 3l9 6.75"></path>
                    <path d="M9 22V12h6v10"></path>
                </svg>

                Dashboard
            </a>

            <a href="{% url 'etudiants:mes_cours' %}"
               class="sidebar-item flex items-center px-4 py-3 rounded-lg
               {% if request.resolver_match.url_name == 'mes_cours' %}
                   active bg-blue-600 text-white
               {% else %}
                   text-gray-300 hover:bg-gray-700 hover:text-white
               {% endif %}">

                <svg class="w-5 h-5 mr-3 shrink-0" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 19.5V6a2 2 0 012-2h11a3 3 0 013 3v12.5"></path>
                    <path d="M8 22h8"></path>
                </svg>

                Mes Cours
            </a>

            <a href="{% url 'etudiants:mes_devoirs' %}"
               class="sidebar-item flex items-center px-4 py-3 rounded-lg
               {% if request.resolver_match.url_name == 'mes_devoirs' %}
                   active bg-blue-600 text-white
               {% else %}
                   text-gray-300 hover:bg-gray-700 hover:text-white
               {% endif %}">

                <svg class="w-5 h-5 mr-3 shrink-0" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 3h6l4 4v14a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2z"></path>
                    <path d="M9 12h6"></path>
                    <path d="M9 16h6"></path>
                </svg>

                Mes Devoirs
            </a>

            <a href="{% url 'etudiants:mes_notes' %}"
               class="sidebar-item flex items-center px-4 py-3 rounded-lg
               {% if request.resolver_match.url_name == 'mes_notes' %}
                   active bg-blue-600 text-white
               {% else %}
                   text-gray-300 hover:bg-gray-700 hover:text-white
               {% endif %}">

                <svg class="w-5 h-5 mr-3 shrink-0" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 11l3 3 6-6"></path>
                    <path d="M20.3 11.3a8.9 8.9 0 11-6.6-6.6"></path>
                </svg>

                Mes Notes
            </a>

            <a href="{% url 'etudiants:mes_soumissions' %}"
               class="sidebar-item flex items-center px-4 py-3 rounded-lg
               {% if request.resolver_match.url_name == 'mes_soumissions' %}
                   active bg-blue-600 text-white
               {% else %}
                   text-gray-300 hover:bg-gray-700 hover:text-white
               {% endif %}">

                <svg class="w-5 h-5 mr-3 shrink-0" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M7 18a4 4 0 01-.9-7.9A5 5 0 1116 7"></path>
                    <path d="M12 12v7"></path>
                    <path d="M9 15l3-3 3 3"></path>
                </svg>

                Mes Soumissions
            </a>
        </nav>

        <!-- Logout -->
        <div class="p-4 border-t border-gray-700">
            <a href="{% url 'admin_logout' %}" class="sidebar-item flex items-center px-4 py-3 rounded-lg hover:bg-gray-700">
                Déconnexion
            </a>
        </div>
    </aside>

    <!-- MAIN -->
    <div class="flex-1 flex flex-col">

        <!-- TOPBAR -->
        <header class="bg-gray-800 border-b border-gray-700 px-4 py-3 flex items-center justify-between">

            <!-- Hamburger -->
            <button id="mobile-menu-button" class="md:hidden text-white p-2 rounded hover:bg-gray-700">
                ☰
            </button>

            <h2 class="text-white font-bold text-lg">{% block page_title %}Dashboard{% endblock %}</h2>

            <div class="text-sm text-gray-300">
                {{ user.get_full_name|default:user.username }}
            </div>
        </header>

        <!-- CONTENT -->
        <main class="flex-1 overflow-y-auto p-4">
            {% block content %}{% endblock %}
        </main>
    </div>
</div>

{% else %}
<div class="min-h-screen flex items-center justify-center text-white">
    Accès non autorisé
</div>
{% endif %}

<!-- ===== JS MOBILE SIDEBAR ===== -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const body = document.body;
    const btn = document.getElementById('mobile-menu-button');
    const overlay = document.getElementById('mobile-menu-overlay');
    const sidebar = document.getElementById('sidebar');

    let startX = 0;
    let isSwiping = false;

    const open = () => body.classList.add('sidebar-open');
    const close = () => body.classList.remove('sidebar-open');

    btn?.addEventListener('click', () => {
        body.classList.toggle('sidebar-open');
    });

    overlay?.addEventListener('click', close);

    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') close();
    });

    // Swipe open from left edge
    document.addEventListener('touchstart', e => {
        if (window.innerWidth > 768) return;
        if (e.touches[0].clientX < 20) {
            startX = e.touches[0].clientX;
            isSwiping = true;
        }
    });

    document.addEventListener('touchmove', e => {
        if (!isSwiping) return;
        if (e.touches[0].clientX - startX > 60) open();
    });

    document.addEventListener('touchend', () => {
        isSwiping = false;
    });

    // Swipe close
    sidebar?.addEventListener('touchstart', e => {
        startX = e.touches[0].clientX;
    });

    sidebar?.addEventListener('touchmove', e => {
        if (startX - e.touches[0].clientX > 60) close();
    });
});
</script>

</body>
</html>